---
title: "菜圈的bug"
date: 2019-12-08T20:26:44+08:00
draft: false
---




## 今天发现了一个bug


我的页面是有三个状态或者更多，我会定义一个`renderTree`函数，根据`pageStatus`的不同返回不同的dom

这个时候就像如下伪代码，期望当我的状态变了会呈现不同的页面


```ts
const renderTree = useCallback(() => {
  switch(pageStatus) {
    case 0: return <Modal>{modalValue}</Modal>;
    case 1: return <Stepper>{content}</Stepper>;
    default: return ...;
  }
}, [pageStatus])
```



但是紧接着，我的其中一个`case`里面有一个步进器去加减一个数的组件。

当我去加减的时候发现数值似乎并没有发生变化。

这当然也不是牧老师的组件的问题，一定是我又写了bug！


经过牧老师的提醒，可能是`useCallback`使用上有些问题。其实是我的依赖项写少了。

当我的页面的显示依赖了很多的变量的时候，就需要考虑周全把他们都写上。


所以上面伪代码需要改成如下


```ts
const renderTree = useCallback(() => {
  switch(pageStatus) {
    case 0: return <Modal>{modalValue}</Modal>;
    case 1: return <Stepper>{content}</Stepper>;
    default: return ...;
  }
}, [pageStatus, modalValue, content])
```


[举例](https://codesandbox.io/s/objective-elbakyan-u37dk)


## 记住！

git push origin --delete + 远端分支    //删除远端分支