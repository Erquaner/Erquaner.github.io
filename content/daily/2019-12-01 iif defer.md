---
title: "iif defer"
date: 2019-12-01T19:09:39+08:00
draft: false
---


## RXJS--iif defer

### iif defer
 - iif相当于js三目运算符，返回Observable,接受2-3个参数

    ```js
    import { iif, of } from 'rxjs';

    let subscribeToFirst: boolean;
    const firstOrSecond = iif(
      () => subscribeToFirst,
      of('first'),
      of('second'),
    );

    subscribeToFirst = false;
    firstOrSecond.subscribe(value => console.log(value));

    // Logs:
    // "first"

    subscribeToFirst = false;
    firstOrSecond.subscribe(value => console.log(value));

    // Logs:
    // "second"

    ```

 - defer接受返回Observable的函数或者Promise

    ```js
      const testDefer = defer(
        () => {
          return Math.random() > 0.5
          ? of('first')
          : interval(1000)
        }
      )

    testDefer.subscribe(x => console.log(x))

    ```

    如果您有更复杂的逻辑，需要在两个以上的Observable之间进行决策，defer 则可能是一个更好的选择。实际上，iif可以方便地实现，defer 并且仅出于方便和易读性的原因而存在。


## css问题 -- border-radius: 50%在部分安卓机上不呈现完全的圆形

这个并不是所有安卓机都会必现，这次这个问题是在小米6上复现的

大概是rem不会完全适配，所以解决方案要不改成px，要么替换成图片，当然还有放大缩小的方法。

``` css
i{
       display inline-block
       width .16rem
       height .16rem
       background-color #D0021B
       border-radius 50%
       transform scale(.5)
       transform-origin: 0% center
   }
```


## review代码

大概review代码....

- re-render问题

```ts
const getLogList = async (offset: number) => {
    try {
      let res = await getLogListApi({ limit: 6, offset: offset });
      setLogList([...logList, ...res.list]);
      setLogTotalNum(res.total);
    } catch (error) {
      errHandler(error);
    }
  };

```

两个set会进行两次render

[演示](https://codesandbox.io/s/quiet-thunder-94h14)


- 拒绝无实际意义的numebr, string等，具体化这些意义以常量的形式展现出来。

    可以存放在constant文件下，比如路由，一些有多种状态1 2 3这样的，可以用枚举列出来











